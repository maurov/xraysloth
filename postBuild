# =====================
# Jupyterlab extensions
# =====================

# Script automatically run by mybinder.org / or manually on `sloth-lab`

# NOTE: if required, set proxy first:
#npm config set proxy "http://domain\username:password@servername:port/"
#npm confit set proxy "http://proxy.esrf.fr:3128/"

# ---------------------------
# IPYMPL / JUPYTER-MATPLOTLIB
# ---------------------------
# https://github.com/matplotlib/jupyter-matplotlib
jupyter labextension install @jupyter-widgets/jupyterlab-manager
jupyter labextension install jupyter-matplotlib

# ------
# DRAWIO
# ------
# https://github.com/QuantStack/jupyterlab-drawio
jupyter labextension install jupyterlab-drawio

# ---
# GIT
# ---
# https://github.com/jupyterlab/jupyterlab-git
jupyter labextension install @jupyterlab/git
jupyter serverextension enable --py jupyterlab_git

# ---
# TOC
# ---
# https://github.com/jupyterlab/jupyterlab-toc
jupyter labextension install @jupyterlab/toc

# -------------------------------------
# EXPERIMENTAL FEATURES: SLOTH-LAB ONLY
# -------------------------------------

if [[ $CONDA_DEFAULT_ENV = *"sloth-lab"* ]]; then

  # Packages specified in `environment-lab.yml`

  # -----
  # LATEX
  # -----
  # https://github.com/jupyterlab/jupyterlab-latex
  jupyter labextension install @jupyterlab/latex

  # ----------------------
  # CODE FORMATTER (BLACK)
  # ----------------------
  # https://github.com/ryantam626/jupyterlab_code_formatter
  jupyter labextension install @ryantam626/jupyterlab_code_formatter
  jupyter serverextension enable --py jupyterlab_code_formatter

  # ------
  # PLOTLY
  # ------
  # https://plot.ly/python/getting-started/#jupyterlab-support-python-35 
  # Avoid "JavaScript heap out of memory" errors during extension installation
  # (OS X/Linux)
  export NODE_OPTIONS=--max-old-space-size=4096
  # Jupyter widgets extension
  jupyter labextension install @jupyter-widgets/jupyterlab-manager@1.0 --no-build
  # jupyterlab renderer support
  jupyter labextension install jupyterlab-plotly@1.1.0 --no-build
  # FigureWidget support
  jupyter labextension install plotlywidget@1.1.0 --no-build
  # JupyterLab chart editor support (optional)
  jupyter labextension install jupyterlab-chart-editor@1.2 --no-build
  # Build extensions (must be done to activate extensions since --no-build is used above)
  jupyter lab build
  # Unset NODE_OPTIONS environment variable
  # (OS X/Linux)
  unset NODE_OPTIONS

  # ------------
  # GOOGLE-DRIVE
  # ------------
  # https://github.com/jupyterlab/jupyterlab-google-drive
  #jupyter labextension install @jupyterlab/google-drive

fi;
